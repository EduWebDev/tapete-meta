<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <title>Tapete META 3.0</title>

    <style>
        *{
            padding: 0px;
            margin: 0px;
            box-sizing: border-box;
            font-family: Arial, Helvetica, sans-serif;
        }
        body{
            background-color: #222;
        }
        #header{
            background-color: #000;
            color: #FFF;
            padding: 15px 0;
            text-align: center;
            font-size: 12px;
            max-width: 400px;
            margin: auto;
        }
        span#meta{
            color: aqua;
            text-decoration: underline;
        }
        #allGame{
            max-width: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: auto;
            padding: 0px 20px 20px 20px;
            background-color: black;
        }
        #tapete-robotico{
            width: auto;
        }
        .cell{
            width: 51px;
            height: 51px;
            background-color: #CCC;
            border: 1px solid black;
        }
        .row{
            display: flex;
        }
        .cell.passed{
            background-color: aquamarine;
        }
        .cell.active{
            background-color: aqua;
            background-image: url("robo1.png");
            background-size: 100%;
        }
        .cell.error{
            background-color: red;
            background-image: url("robo1.png");
            background-size: 100%;
        }
        #display-comands{
            min-height: 60px;
            max-height: 120px;
            width: 100%;
            border: 2px dotted #FFF;
            color: #FFF;
        }
        button{
            height: 80px;
            width: 80px;
            border-radius: 10px;
        }
        .executing{
            color: aqua;
            text-decoration: underline;
        }
        #controllers{
            max-width: 400px;
            display: flex;
            flex-direction: column;
            gap: 20px
            
        }
        #play-restart-button{
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        #play-restart-button #play i{
            font-size: 50px;
        }
        #play-restart-button #play{
            width: 100%;
            background-color: aqua;
        }
        #play-restart-button #restart{
            width: 30px;
            height: 30px;
            border-radius: 15px; 
        }
        #comand-buttons{
            max-width: 400px;
        }
        #comand-buttons i{
            font-weight: bold;
        }
        #buttonRow1{
            display: flex;
            justify-content: center;
        }
        #buttonRow2{
            display: flex;
            justify-content: space-between;
        }
        #buttonRow3{
            display: flex;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div id="header">
        <h1>Tapete Rob√≥tivo <span id="meta">META</span></h1>
    </div>
    <div id="allGame">
        <div id="tapete-robotico">
            <div class="row">
                <div class="cell">
                    <div class="robo-rotate90"></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
            </div>
            <div class="row">
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
            </div>
            <div class="row">
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
            </div>
            <div class="row">
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
            </div>
            <div class="row">
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
            </div>
            <div class="row">
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
            </div>
            <div class="row">
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
                <div class="cell">
                    <div class=""></div>
                </div>
            </div>
        </div>

        <br>

        <div id="display-comands"></div>
    
        <br>
        <br>
        
        <div id="controllers">
            <div id="comand-buttons">
                <button onclick='addComand("undo")'><i class="material-icons">undo</i></button>
                <button onclick='addComand("arrow_upward")'><i class="material-icons">arrow_upward</i></button>
                <button onclick='addComand("arrow_downward")'><i class="material-icons">arrow_downward</i></button>
                <button onclick='addComand("redo")'><i class="material-icons">redo</i></button>
            </div>
            <div id="play-restart-button">
                <button id="play" onClick=runComands()><i class="material-icons">play_circle_outline</i></button><br>
                <button id="restart" onClick=resetGame()><i class="material-icons">replay</i></button>
            </div>
        </div>
    </div>
    

    <script>
        const cells = []
        let comands = []
        let comandstoRun = []
        let currentPosition = 0
        let currentOrientation = "right"
        let myInterval = null

        const tapeteNumberOfCells = document.querySelectorAll(".cell").length
        const tapeteHeight = document.querySelectorAll(".row").length
        const tapeteWidth = document.querySelectorAll(".row")[0].querySelectorAll(".cell").length
        
        
        let count = 0
        function fillCells() {
            for (let i = 1; i <= tapeteHeight; i++) {
                for (let j = 1; j <= tapeteWidth; j++) {
                    cells[count] = {
                        pointCenter: [i,j],
                        pointTop: [i-1,j],
                        pointRight: [i,j+1],
                        pointLeft: [i,j-1],
                        pointBottom: [i+1,j]
                    }
                    count++
                }
            }
        }

        function addComand(comand) {
            comands.push(comand)
            const displayComands = document.querySelector("#display-comands")
            displayComands.innerHTML += '<i class="material-icons">' + comand + '</i>'

            switch (comand) {
                case "arrow_upward":
                    comandstoRun.push(()=>updadePosition("toward"))
                    break;
                case "arrow_downward":
                    comandstoRun.push(()=>updadePosition("back"))
                    break;
                case "redo":
                    comandstoRun.push(()=>updateOrientation("right"))
                    break;
                case "undo":
                    comandstoRun.push(()=>updateOrientation("left"))
                    break;
            
                default:
                    break;
            }
        }

        function manageOrientation(rightOrleft) {
            const cellActive = document.querySelector(".active")
            switch (currentOrientation) {
                case "top":
                    cellActive.style.transform = "rotate(0deg)"
                    break;
                case "bottom":
                    cellActive.style.transform = "rotate(180deg)"
                    break;
                case "right":
                    cellActive.style.transform = "rotate(90deg)"
                    break;
                case "left":
                    cellActive.style.transform = "rotate(270deg)"
                    break;

                default:
                    break;
            }
        }

        function updateOrientation(rightOrleft) {
            // currentOrientation = orientation
            const cellActive = document.querySelector(".active")

            if (rightOrleft === "right") {
                switch (currentOrientation) {
                    case "top":
                        cellActive.style.transform = "rotate(90deg)"
                        currentOrientation = "right"
                        break;
                    case "bottom":
                        cellActive.style.transform = "rotate(270deg)"
                        currentOrientation = "left"
                        break;
                    case "right":
                        cellActive.style.transform = "rotate(180deg)"
                        currentOrientation = "bottom"
                        break;
                    case "left":
                        cellActive.style.transform = "rotate(0deg)"
                        currentOrientation = "top"
                        break;
                
                    default:
                        break;
                }
            }

            if (rightOrleft === "left") {
                switch (currentOrientation) {
                    case "top":
                        cellActive.style.transform = "rotate(270deg)"
                        currentOrientation = "left"
                        break;
                    case "bottom":
                        cellActive.style.transform = "rotate(90deg)"
                        currentOrientation = "right"
                        break;
                    case "right":
                        cellActive.style.transform = "rotate(0deg)"
                        currentOrientation = "top"
                        break;
                    case "left":
                        cellActive.style.transform = "rotate(180deg)"
                        currentOrientation = "bottom"
                        break;
                
                    default:
                        break;
                }
            }
            
        }

        function updadePosition(towardOrBack) {
            const cellActive = document.querySelector(".active")
            cellActive.classList.remove("active")
            let index
            
            if (towardOrBack === "toward") {
                switch (currentOrientation) {
                    case "top":
                        index = cells[currentPosition].pointTop[0]
                        if(index < 1){
                            console.log("ERRO");
                            clearInterval(myInterval)
                            cellActive.classList.add("error")
                            return
                        }
                        currentPosition = currentPosition - tapeteWidth
                        break;
                    case "bottom":
                        index = cells[currentPosition].pointBottom[0]
                        if(index > tapeteHeight){
                            console.log("ERRO");
                            clearInterval(myInterval)
                            cellActive.classList.add("error")
                            return
                        }
                        currentPosition = currentPosition + tapeteWidth
                        break;
                    case "right":
                        index = cells[currentPosition].pointRight[1]
                        if(index > tapeteWidth){
                            console.log("ERRO");
                            clearInterval(myInterval)
                            cellActive.classList.add("error")
                            return
                        }
                        currentPosition = currentPosition + 1
                        break;
                     case "left":
                        index = cells[currentPosition].pointLeft[1]
                        if(index < 1){
                            console.log("ERRO");
                            clearInterval(myInterval)
                            cellActive.classList.add("error")
                            return
                        }
                        currentPosition = currentPosition - 1
                        break;
                
                    default:
                        break;
                }
            }

            if (towardOrBack === "back") {
                switch (currentOrientation) {
                    case "top":
                        index = cells[currentPosition].pointBottom[0]
                        if(index > tapeteHeight){
                            console.log("ERRO");
                            clearInterval(myInterval)
                            cellActive.classList.add("error")
                            return
                        }
                        currentPosition = currentPosition + tapeteWidth
                        break;
                    case "bottom":
                        index = cells[currentPosition].pointTop[0]
                        if(index < 1){
                            console.log("ERRO");
                            clearInterval(myInterval)
                            cellActive.classList.add("error")
                            return
                        }
                        currentPosition = currentPosition - tapeteWidth
                        break;
                    case "right":
                        index = cells[currentPosition].pointLeft[1]
                        if(index > tapeteWidth){
                            console.log("ERRO");
                            clearInterval(myInterval)
                            cellActive.classList.add("error")
                            return
                        }
                        currentPosition = currentPosition - 1
                        break;
                     case "left":
                        index = cells[currentPosition].pointRight[1]
                        if(index < 1){
                            console.log("ERRO");
                            clearInterval(myInterval)
                            cellActive.classList.add("error")
                            return
                        }
                        currentPosition = currentPosition + 1
                        break;
                
                    default:
                        break;
                }
            }
            
            const newCellActive = document.querySelectorAll(".cell")[currentPosition]
            newCellActive.classList.add("active")
            newCellActive.classList.add("passed")
            manageOrientation(currentOrientation)
        }

        function runComands() { 
            let i = 0
            const displayComands = document.querySelectorAll("#display-comands i")
            myInterval = setInterval(() => {
                comandstoRun[i]()
                if (i>0){displayComands[i-1].classList.remove("executing")}
                displayComands[i].classList.add("executing")
                i = i + 1
                console.log(i, comandstoRun.length-1);
                if(i > comandstoRun.length-1){
                    clearInterval(myInterval)
                }
            }, 500);
        }

        function restartGame() {
            fillCells()
            const cellActive = document.querySelectorAll(".cell")[0]
            cellActive.classList.add("active")
            cellActive.classList.add("passed")
            manageOrientation("right")
            

        }

        function resetGame() {
            comands = []
            comandstoRun = []
            document.querySelectorAll(".cell").forEach((cell)=>{
                cell.classList.remove("active")
                cell.classList.remove("passed")
                cell.classList.remove("error")
            })
            
            comands = []
            comandstoRun = []
            currentPosition = 0
            currentOrientation = "right"
            myInterval = null
            document.querySelector("#display-comands").innerHTML = ""
            
            const cellActive = document.querySelectorAll(".cell")[0]
            cellActive.classList.add("active")
            cellActive.classList.add("passed")
        }

        restartGame()
    </script>
</body>
</html>